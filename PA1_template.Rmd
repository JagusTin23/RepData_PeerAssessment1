---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
```{r echo =TRUE} 
library(lubridate)
file <- "activity.csv"
data <- read.csv(file, header = TRUE, stringsAsFactor = FALSE)
data$date <- ymd(data$date)
```

## What is mean total number of steps taken per day?
```{r mean_median, echo =TRUE}
steps_day <- with(data, aggregate(steps, by = list(date), FUN=sum))    
hist(steps_day[,2], main = "Steps Taken Per Day", col = "turquoise", xlab = "steps/day")
mean(steps_day[,2], na.rm = TRUE)  
median(steps_day[,2], na.rm = TRUE) 
```   

## What is the average daily activity pattern?
```{r}
library(dplyr)
by_interval <- 
    data %>%
    select(interval, steps) %>%
    group_by(interval) %>%
    summarize(avgStepsInt = mean(steps, na.rm = TRUE))
maxActiveInt <- as.numeric(by_interval[by_interval$avgStepsInt == max(by_interval$avgStepsInt),1])
maxSteps <-  round(max(by_interval$avgStepsInt))
```
```{r dailyplot, echo=TRUE}
plot(by_interval$interval, by_interval$avgStepsInt, type = "l", xlab = "5-minute interval", ylab = "steps")
```  

The 5 minute interval with the maximun number of steps is interval **`r maxActiveInt`** with an average of **`r maxSteps`** of steps taken.  

## Imputing missing values

```{r echo =TRUE}
countNA <- length(which(is.na(data$steps)))
data_ver <- data[which(is.na(data$steps)),]
verif <- 
    data_ver %>%
    group_by(date) %>% 
    summarize(count = n(),
              sum_int = sum(interval))
```  
There is a total of **`r countNA`** rows with missing values.  

After careful evaluation of the data, it was clear that there were full days in which values for the steps variable were not available. To verify this, a data set was created by subsetting the original dataset with the rows with missing values counting the number of rows and the sum of the interval. See the table below:  
```{r echo=FALSE}
print(as.data.frame(verif))
```  
The number of rows with missing values in each day is 288 which corresponds to the number of interval recorded per day. This evaluation was performed to ensure there were no days with both recorded and missing values.  

This information was used to devise a strategy for inputing missing values. The strategy consist of inputing the missing values with the mean steps per interval calculated in the previous step. A new dataset was created by subsetting the original dataset by each date corresponding to missing values and inputting the the mean values per interval. 

```{r echo=TRUE}
data2 <- read.csv(file, header = TRUE, stringsAsFactor = FALSE)
data2[which(data2$date == "2012-10-01"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-10-08"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-11-01"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-11-04"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-11-09"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-11-10"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-11-14"),1] <- by_interval$avgStepsInt
data2[which(data2$date == "2012-11-30"),1] <- by_interval$avgStepsInt
data2$date <- ymd(data2$date)
by_date2 <- 
    data2 %>%
    select(date, steps) %>%
    group_by(date) %>%
    summarize(stepsDay2 = sum(steps))
Avg_steps2 <- round(mean(by_date2$stepsDay2))
Median_steps2 <- median(by_date2$stepsDay2)
hist(by_date2$stepsDay2, main = "Steps Taken Per Day", col = "steelblue1", xlab = "steps/day")
```  

As can be seen, the data has been normalized by imputting missing values with the mean steps taken per 5 minute interval. The new **mean** and **median** are equal with a value of **10766.19**.  

The data was not affected drastically by imputing the missing values with the mean interval values. The median shifted to the mean and the total number of steps taken daily slightly increased as can be seen from the histogram.  

## Are there differences in activity patterns between weekdays and weekends?

```{r echo=TRUE}
weekend <- c("Saturday", "Sunday")
data2$wkday <- factor((weekdays(data2$date) %in% weekend), levels=c(FALSE, TRUE), labels=c('weekday', 'weekend'))

wkdata <- aggregate(steps~interval+wkday, data2, FUN=mean)
library(lattice)
xyplot(steps~interval|wkday, wkdata, layout=c(1,2), type = "l")
dev.off()
```


